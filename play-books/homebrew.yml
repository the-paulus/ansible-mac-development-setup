---
- name: Install Brews
  homebrew:
    install_options: "{{ item.options }}"
    name: "{{ item.name }}"
    update_homebrew: yes
    upgrade_all: yes
    state: "{{ operation }}"
  with_items: "{{ brew_taps }}"

- name: "Link PHP version"
  homebrew:
    name: "php@{{ php_version }}"
    state: linked
  when: operation == "present"

- name: "Unlink PHP version"
  homebrew:
    name: "php@{{ php_version }}"
    state: unlinked
  when: operation == "absent"

- name: Install Casks
  homebrew_cask:
    name: "{{ item.name }}"
    install_options: "{{ item.options }}"
    state: "{{ operation }}"
  with_items: "{{ brew_casks }}"

- name: Get Homebrew Prefix
  shell: brew --prefix
  register: homebrew_home

- set_fact:
  homebrew_home: "{{ homebrew_home.stdout }}"
